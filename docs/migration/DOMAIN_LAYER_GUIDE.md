# üéØ –ì–∏–¥ –ø–æ –¥–æ–º–µ–Ω–Ω–æ–º—É —Å–ª–æ—é –≤ Laravel

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤: –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ Laravel –ø—Ä–æ–µ–∫—Ç–µ.

## ü§î –ß—Ç–æ —Ç–∞–∫–æ–µ –¥–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π?

**–î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π** - —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –∂–∏–≤—É—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ "–ó—É–±—Ä–∏–ª–∫–∞":

```php
// üß† –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
"–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –Ω–µ —Ä–∞–∑–º–µ—á–∞–µ—Ç—Å—è —Ç–∞–π–º–∏–Ω–≥–æ–º"
"–°—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ –º–æ–∂–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã"
"–í—Ä–µ–º—è —Ç–∞–π–º–∏–Ω–≥–∞ –Ω–µ –º–æ–∂–µ—Ç –∏–¥—Ç–∏ –Ω–∞–∑–∞–¥"
"–ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∏—Ö–∞—Ö –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è"

// üèóÔ∏è –ó–Ω–∞–Ω–∏—è –æ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏  
"–ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ, —Ñ—Ä–∞–≥–º–µ–Ω—Ç, —Å—Ç—Ä–æ–∫–∞"
"–ö–∞–∫ —Å–≤—è–∑–∞–Ω—ã –∞–≤—Ç–æ—Ä—ã –∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è"
"–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç '–∞–∫—Ç–∏–≤–Ω—ã–π' —Ç—Ä–µ–∫"
"–ö–æ–≥–¥–∞ —Ç—Ä–µ–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è '–≥–æ—Ç–æ–≤—ã–º'"

// ‚öñÔ∏è –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
"–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏ –∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω—ã"
"–°–≤—è–∑–∏ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏"
"–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π"
```

### ‚ùå –ù–ï –¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞:

```php
// üóÑÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
SQL –∑–∞–ø—Ä–æ—Å—ã, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –≤–Ω–µ—à–Ω–∏–µ API

// üñ•Ô∏è –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è  
HTTP –æ–±—Ä–∞–±–æ—Ç–∫–∞, JSON —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º

// üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞
–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```

## üèóÔ∏è –°–ø–µ–∫—Ç—Ä –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–µ

### 1. ‚ùå **Anemic Models** (–ø–ª–æ—Ö–æ)

```php
// –ú–æ–¥–µ–ª—å - —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ
class Poem extends Model 
{
    protected $fillable = ['title', 'status'];
    // –ù–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏
}

// –í—Å—è –ª–æ–≥–∏–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
class PoemService 
{
    public function publish(Poem $poem) { /* –ª–æ–≥–∏–∫–∞ */ }
    public function canPublish(Poem $poem) { /* –ª–æ–≥–∏–∫–∞ */ }
    public function calculateReadingTime(Poem $poem) { /* –ª–æ–≥–∏–∫–∞ */ }
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –î–∞–Ω–Ω—ã–µ –∏ –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –û–û–ü
- –¢—Ä—É–¥–Ω–æ –Ω–∞–π—Ç–∏ –ª–æ–≥–∏–∫—É
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### 2. ‚úÖ **Rich Models** (—Ö–æ—Ä–æ—à–æ –¥–ª—è Laravel)

```php
class Poem extends Model 
{
    // –õ–æ–≥–∏–∫–∞ —Ä—è–¥–æ–º —Å –¥–∞–Ω–Ω—ã–º–∏
    public function publish(): bool
    {
        if (!$this->canBePublished()) {
            return false;
        }
        
        $this->update(['status' => 'published']);
        event(new PoemPublished($this));
        return true;
    }
    
    public function canBePublished(): bool
    {
        return $this->fragments()->exists() && 
               $this->fragments()->whereHas('verses')->exists();
    }
    
    public function calculateReadingTime(): int
    {
        $wordCount = $this->getWordCount();
        return max(1, ceil($wordCount / 150));
    }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ–æ–≥–∏–∫–∞ —Ç–∞–º, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –û–û–ü
- –õ–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å
- Laravel-way –ø–æ–¥—Ö–æ–¥

### 3. ‚úÖ **Domain Services** (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)

```php
class Poem extends Model 
{
    // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –º–æ–¥–µ–ª–∏
    public function isPublished(): bool
    {
        return $this->status === 'published';
    }
}

class PoemCreationService 
{
    // –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–Ω–æ—Å–∏—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å
    public function createFromText(string $title, string $text, array $authorIds): Poem
    {
        return DB::transaction(function() use ($title, $text, $authorIds) {
            $poem = Poem::create(['title' => $title]);
            $this->linkAuthors($poem, $authorIds);
            $this->createFragmentsFromText($poem, $text);
            $this->indexForSearch($poem);
            return $poem;
        });
    }
}
```

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

### ‚úÖ Rich Models - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:

#### 1. **–ü—Ä–æ—Å—Ç—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª**

```php
class Track extends Model 
{
    // ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    public function isTimingComplete(): bool
    {
        $versesCount = $this->fragment->verses()->count();
        $timingsCount = $this->timings()->count();
        
        // –î–æ–º–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è
        return $timingsCount >= ($versesCount - 1);
    }
    
    // ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    public function activate(): bool
    {
        if (!$this->isTimingComplete()) {
            return false;
        }
        
        $this->update(['status' => 'active']);
        event(new TrackActivated($this));
        return true;
    }
    
    // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è
    public function canBeActivated(): bool
    {
        return $this->status === 'draft' && $this->isTimingComplete();
    }
}
```

#### 2. **–í—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

```php
class Poem extends Model 
{
    // ‚úÖ –†–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    public function calculateReadingTime(): int
    {
        $wordCount = $this->fragments
            ->flatMap->verses
            ->sum(fn($line) => str_word_count($line->text));
            
        return max(1, ceil($wordCount / 150)); // 150 —Å–ª–æ–≤ –≤ –º–∏–Ω—É—Ç—É
    }
    
    // ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    public function getPreviewVerses(int $limit = 2): array
    {
        return $this->fragments()
            ->orderBy('sort_order')
            ->first()
            ?->verses()
            ->limit($limit)
            ->pluck('text')
            ->toArray() ?? [];
    }
    
    // ‚úÖ –ê–Ω–∞–ª–∏–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    public function hasAudio(): bool
    {
        return $this->fragments()->whereHas('tracks', function($q) {
            $q->where('status', 'active');
        })->exists();
    }
}
```

#### 3. **–í–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–æ–∫**

```php
class Fragment extends Model 
{
    // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    public function hasActiveAudio(): bool
    {
        return $this->tracks()->where('status', 'active')->exists();
    }
    
    public function canBeDeleted(): bool
    {
        return !$this->hasActiveAudio() || $this->status === 'draft';
    }
    
    public function isReadyForPublishing(): bool
    {
        return $this->verses()->exists() && 
               $this->status === 'draft' &&
               $this->hasRequiredFields();
    }
    
    // ‚úÖ –î–æ–º–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
    public function getSize(): string
    {
        $lineCount = $this->verses()->count();
        
        if ($lineCount <= 10) return 'short';
        if ($lineCount <= 30) return 'medium';
        return 'large';
    }
}
```

#### 4. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ**

```php
class Track extends Model 
{
    // ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    public function getFormattedDuration(): string
    {
        $minutes = floor($this->duration / 60);
        $seconds = $this->duration % 60;
        return sprintf('%d:%02d', $minutes, $seconds);
    }
    
    public function getPlayUrl(): string
    {
        return asset("uploads/audio/{$this->fragment_id}/{$this->filename}");
    }
}
```

### ‚úÖ Domain Services - –≤—ã–Ω–æ—Å–∏—Ç–µ –¥–ª—è:

#### 1. **–°–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤**

–ü—Ä–∏–º–µ—Ä –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ - **TimingService**:

```php
class TimingDomainService 
{
    // ‚ùå –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è Rich Model
    public function setVerseTiming(Track $track, Verse $verse, float $endTime): void
    {
        // 1. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        $this->validateLastVerseRule($track, $verse);
        $this->validateTimeBounds($track, $endTime);
        $this->validateSequentialOrder($track, $line, $endTime);
        
        // 2. –†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
        $track->timings()->updateOrCreate(
            ['verse_id' => $verse->id],
            ['end_time' => $endTime]
        );
        
        // 3. –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        $this->recalculateRelatedTimings($track, $line);
        $this->updateTrackCompletionStatus($track);
        
        // 4. –°–æ–±—ã—Ç–∏—è
        event(new VerseTimingUpdated($track, $verse, $endTime));
    }
    
    private function validateLastVerseRule(Track $track, Verse $verse): void
    {
        if ($line->isLast()) {
            throw new DomainException('Last line timing is fixed to track duration');
        }
    }
    
    private function validateTimeBounds(Track $track, float $endTime): void
    {
        if ($endTime <= 0 || $endTime > $track->duration) {
            throw new DomainException('Invalid timing bounds');
        }
    }
    
    private function validateSequentialOrder(Track $track, Verse $verse, float $endTime): void
    {
        $previousTiming = $track->getLastTimingBefore($line);
        if ($previousTiming && $endTime < $previousTiming->end_time) {
            throw new DomainException('Timing cannot go backwards');
        }
    }
}
```

#### 2. **–°–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤**

–ü—Ä–∏–º–µ—Ä –∏–∑ –≤–∞—à–µ–≥–æ **PoemProcessor**:

```php
class PoemCreationService 
{
    public function __construct(
        private MeilisearchIndexer $indexer,
        private PoemValidator $validator
    ) {}
    
    public function createPoemWithFragments(CreatePoemData $data): Poem
    {
        $this->validator->validate($data);
        
        return DB::transaction(function() use ($data) {
            // 1. –°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å
            $poem = Poem::create([
                'title' => $data->title,
                'year_written' => $data->yearWritten,
                'status' => 'draft',
                'is_divided' => $data->isDivided,
            ]);
            
            // 2. –°–≤—è–∑–∞—Ç—å —Å –∞–≤—Ç–æ—Ä–∞–º–∏
            $this->linkAuthors($poem, $data->authorIds);
            
            // 3. –°–æ–∑–¥–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
            foreach ($data->fragments as $fragmentData) {
                $fragment = $this->createFragment($poem, $fragmentData);
                $this->createVerses($fragment, $fragmentData['text']);
            }
            
            // 4. –í–Ω–µ—à–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            $this->indexer->indexPoem($poem);
            event(new PoemCreated($poem));
            
            return $poem->load(['authors', 'fragments.verses']);
        });
    }
    
    private function createVerses(Fragment $fragment, string $text): void
    {
        $verses = Poem::parseTextToVerses($text); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏
        
        foreach ($verses as $index => $lineData) {
            $fragment->verses()->create([
                'position' => $index + 1,
                'text' => $lineData['text'],
                'end_line' => $lineData['end_line'],
            ]);
        }
    }
}
```

#### 3. **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –º–µ–∂–¥—É –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏**

```php
class AudioProcessingService 
{
    public function __construct(
        private AudioProcessor $processor,
        private FileManager $fileManager,
        private AudioValidator $validator
    ) {}
    
    public function processUploadedAudio(Fragment $fragment, UploadedFile $file, string $title): Track
    {
        // –†–∞–±–æ—Ç–∞–µ–º —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–æ–º–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
        
        // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è (–≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)
        $this->validator->validateAudioFile($file);
        
        // 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ (–≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)
        $duration = $this->processor->getDuration($file);
        $filename = $this->fileManager->generateUniqueFilename($title);
        
        // 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)
        $path = $this->fileManager->storeAudio($fragment, $file, $filename);
        
        // 4. –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
        $track = $fragment->tracks()->create([
            'filename' => $filename,
            'original_filename' => $file->getClientOriginalName(),
            'duration' => $duration,
            'title' => $title,
            'sort_order' => $fragment->getNextTrackOrder(), // –ú–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏
            'status' => 'draft',
        ]);
        
        // 5. –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
        event(new AudioUploaded($track));
        
        return $track;
    }
}
```

## üìä –ü—Ä–∞–≤–∏–ª–æ 80/20 –¥–ª—è Laravel

- **80% –ª–æ–≥–∏–∫–∏** ‚Üí Rich Models
- **20% –ª–æ–≥–∏–∫–∏** ‚Üí Domain Services

## üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å–∏–º –≤ Rich Models

#### –ò–∑ TimingService ‚Üí Track Model:
```php
class Track extends Model 
{
    // ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –º–æ–¥–µ–ª–∏
    public function isTimingComplete(): bool
    {
        $versesCount = $this->fragment->verses()->count();
        $timingsCount = $this->timings()->count();
        return $timingsCount >= ($versesCount - 1);
    }
    
    public function canBeActivated(): bool
    {
        return $this->status === 'draft' && $this->isTimingComplete();
    }
    
    public function activate(): bool
    {
        if (!$this->canBeActivated()) {
            return false;
        }
        
        $this->update(['status' => 'active']);
        event(new TrackActivated($this));
        return true;
    }
}
```

#### –ò–∑ PoemProcessor ‚Üí Poem Model:
```php
class Poem extends Model 
{
    // ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ - –¥–æ–º–µ–Ω–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ
    public static function parseTextToVerses(string $text): array
    {
        $verses = [];
        $textVerses = explode("\n", $text);
        
        foreach ($textVerses as $line) {
            $line = trim($line);
            if ($line !== '') {
                $verses[] = [
                    'text' => $line,
                    'end_line' => false // –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
                ];
            }
        }
        
        return $verses;
    }
    
    // ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    public function canBePublished(): bool
    {
        return $this->fragments()->exists() && 
               $this->fragments()->whereHas('verses')->exists();
    }
    
    public function publish(): bool
    {
        if (!$this->canBePublished()) {
            return false;
        }
        
        $this->update(['status' => 'published']);
        event(new PoemPublished($this));
        return true;
    }
}
```

### ‚úÖ –í—ã–Ω–æ—Å–∏–º –≤ Domain Services

#### –°–ª–æ–∂–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–æ–∑–¥–∞–Ω–∏—è:
```php
class PoemCreationService 
{
    // ‚ùå –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è –º–æ–¥–µ–ª–∏
    public function createFromFormData(array $formData): Poem
    {
        // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        // –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è
        // –°–æ–±—ã—Ç–∏—è
    }
}
```

#### –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–∞–π–º–∏–Ω–≥–æ–≤:
```php
class TimingDomainService 
{
    // ‚ùå –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è –º–æ–¥–µ–ª–∏
    public function setVerseTiming(Track $track, Verse $verse, float $endTime): void
    {
        // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        // –†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
        // –ü–µ—Ä–µ—Å—á–µ—Ç—ã
        // –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    }
}
```

## üöÄ –ò—Ç–æ–≥–æ: –í–∞—à–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –í –º–æ–¥–µ–ª—è—Ö –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ:
```php
// ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
$poem->isPublished()
$track->isActive()
$fragment->hasAudio()

// ‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö
$poem->calculateReadingTime()
$track->getFormattedDuration()

// ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
$poem->publish()
$track->activate()

// ‚úÖ –í—Å–µ–≥–¥–∞ –≤ –º–æ–¥–µ–ª—è—Ö
Scopes, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —Å–æ–±—ã—Ç–∏—è –º–æ–¥–µ–ª–∏
```

### –í Domain Services –≤—ã–Ω–æ—Å–∏—Ç–µ:
```php
// ‚úÖ –°–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã
TimingDomainService::setVerseTiming()
PoemCreationService::createFromText()
AudioProcessingService::processUpload()

// ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
// ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É
// ‚úÖ –†–∞–±–æ—Ç—É —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```

## üéØ –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

> **–ï—Å–ª–∏ –ª–æ–≥–∏–∫–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ 10-15 —Å—Ç—Ä–æ–∫ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–∞–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ - –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –≤ Rich Model.**
> 
> **–ï—Å–ª–∏ –ª–æ–≥–∏–∫–∞ —Å–ª–æ–∂–Ω–∞—è, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏–ª–∏ –≤–∫–ª—é—á–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ - –≤—ã–Ω–æ—Å–∏—Ç–µ –≤ Domain Service.**

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –¥–∞—Å—Ç –≤–∞–º –ª—É—á—à–µ–µ –∏–∑ –æ–±–æ–∏—Ö –º–∏—Ä–æ–≤: –ø—Ä–æ—Å—Ç–æ—Ç—É Rich Models + –º–æ—â—å Domain Services –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤! üéØ