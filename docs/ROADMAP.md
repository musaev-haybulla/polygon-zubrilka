# Дорожная карта проекта

Данный документ содержит план ближайших этапов развития проекта.

## Инструменты автоматизации задач (Task, Just и др.)

Цель: упростить и унифицировать запуск рутинных команд разработки без отдельных shell-оберток.

- Исследовать и выбрать инструмент: [Task](https://taskfile.dev) или [Just](https://github.com/casey/just).
- Подготовить прототип с командами:
  - composer: install/update/require/remove/show/outdated
  - phinx: status/migrate/rollback/create/seed:run
  - docker: up/down/build/shell
- Добавить `Taskfile.yml` или `Justfile` в корень проекта.
- Обеспечить кроссплатформенность (macOS/Linux) и работу в CI.
- Обновить документацию: `README.md` и `docs/CONTRIBUTING.md` с примерами запуска.
- Постепенно депрекейтнуть `composer.sh` и `phinx.sh` после миграции.

Критерии готовности:
- Один источник правды для команд.
- Повторяемость сред и простота онбординга.
- Команды самодокументируемы (`task --list` или `just --list`).

## Редактирование фрагментов

### Базовая функциональность
Необходимо реализовать возможность редактирования содержимого фрагментов поэм.

### Обработка существующих озвучек при редактировании

При изменении текста фрагмента пользователю предоставляется выбор из трёх вариантов действий:

**Вариант 1: Полная очистка**
- Удаление всех аудиофайлов из директории `uploads/audio/{fragment_id}/` с использованием `AudioFileHelper`
- Удаление записей таймингов через `TimingService`
- Очистка таблицы озвучек для данного фрагмента
- Переиндексация изменённого текста при его модификации

**Вариант 2: Сохранение с предупреждением**
- Сохранение существующих озвучек с пониманием возможных расхождений
- Два подварианта:
  - Немедленный переход к интерфейсу переразметки с выполнением индексации текста
  - Отложенная переразметка с сохранением только текстовых изменений и выполнением индексации

**Вариант 3: Отмена операции**
- Сохранение текущего состояния без внесения изменений

## Редактирование поэм

Разработка отдельного интерфейса для управления метаданными поэм, включающего:
- Редактирование названия произведения
- Изменение года написания
- Корректировка информации об авторе
- Управление порядком отображения фрагментов внутри поэмы

## Система управления данными в формате Markdown

### Структура данных для экспорта/импорта

Цель: создать удобную систему управления поэтическим контентом в человекочитаемом формате.

**Принятая структура каталогов:**
```
data/
├── authors/
│   ├── Пушкин-АС-1799.md
│   └── Лермонтов-МЮ-1814.md
└── poems/
    ├── onegin/
    │   ├── poem.md
    │   ├── 01-глава-первая.md
    │   └── 02-глава-вторая.md
    └── zimnee-utro.md
```

**Схема генерации ID авторов (текущее решение):**
- Базовый формат: `surname-initials-birth_year`
- При коллизиях: добавление 4-символьного UUID
- Примеры: `pushkin-as-1799`, `ivanov-ii-2000-a4f2`

**Формат файлов:**
- Markdown с YAML frontmatter для метаданных
- Фрагменты поэм: пустые строки = границы строф
- Автоматическая нумерация строк при импорте

**Этапы реализации:**
1. Создание конвертера SQL → Markdown
2. Разработка импортера Markdown → БД  
3. Валидация и тестирование на существующих данных
4. Интеграция в рабочий процесс модераторов

**Критерии готовности:**
- Полная совместимость с существующей схемой БД
- Сохранение всех связей authors ↔ poems ↔ fragments ↔ lines
- Удобство редактирования для модераторов
- Возможность версионирования через Git