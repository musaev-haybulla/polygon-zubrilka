<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zubrilka Grok</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #waveform {
      width: 100%;
      border: 1px solid #dee2e6;
      border-radius: .25rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5" x-data="project">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="mb-3 p-2 bg-white rounded border">
      <nav class="small">
        <a href="search.html" class="text-decoration-none">üîç –ü–æ–∏—Å–∫</a>
        <span class="text-muted mx-2">|</span>
        <a href="poem_list.php" class="text-decoration-none">üéµ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∑–≤—É—á–∫–∞–º–∏</a>
        <span class="text-muted mx-2">|</span>
        <a href="add_simple_poem.php" class="text-decoration-none">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏—Ö</a>
      </nav>
    </div>
    
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Zubrilka Grok</h5>
      </div>
      <div class="card-body">
        <div id="waveform"></div>

        <div class="list-group mb-4">
          <template x-for="(line, index) in lines" :key="index">
            <label class="list-group-item d-flex gap-3 align-items-center">
              <input class="form-check-input m-0" type="radio" :name="radioGroup" :value="index" @change="selectLine(index)" :checked="index === selectedIndex" :disabled="lines[index].startTime === null">
              <span class="flex-grow-1" x-text="line.text"></span>
              <div class="input-group" style="width: 220px;">
                <input type="number" class="form-control" step="0.01" x-model.number="lines[index].startTime" @input="validateTime(index, 'start')" :disabled="index === 0" title="Start time">
                <input type="number" class="form-control" step="0.01" x-model.number="lines[index].endTime" @input="validateTime(index, 'end')" :disabled="index === lines.length - 1" title="End time">
              </div>
            </label>
          </template>
        </div>

        <div class="d-flex align-items-center justify-content-center gap-2 p-3 mb-3 bg-secondary-subtle border rounded">
          <button class="btn btn-primary" @click="selectPreviousLine" :disabled="isFirstLine">‚Üê –ù–∞–∑–∞–¥</button>
          <span class="badge text-bg-dark fs-6" x-text="effectiveRegion.startTime"></span>
          <span class="flex-grow-1 text-center p-2 border rounded bg-white text-truncate" style="min-height: 40px;" x-text="effectiveRegion.text"></span>
          <span class="badge text-bg-dark fs-6" x-text="effectiveRegion.endTime"></span>
          <button class="btn btn-primary" @click="selectNextLine" :disabled="isLastLine">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
        </div>

        <div class="d-flex justify-content-center flex-wrap gap-2">
          <button class="btn btn-success" @click="togglePlayPause">
            <span x-text="isPlaying ? '–ü–∞—É–∑–∞' : '–ü–ª–µ–π'"></span>
          </button>
          <button class="btn btn-info" @click="saveCurrentRegion">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
      <div class="card-footer text-muted text-center">
        ¬© 2024 Zubrilka Grok
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://unpkg.com/wavesurfer.js@7"></script>
  <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/regions.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('project', () => ({
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        MIN_DURATION: 0.5,
        
        // –î–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
        pausesArray: [2.23, 4.62, 6.18, 8.35],
        lines: [
          { text: '–£–º–æ–º –†–æ—Å—Å–∏—é –Ω–µ –ø–æ–Ω—è—Ç—å', startTime: 0, endTime: null },
          { text: '–ê—Ä—à–∏–Ω–æ–º –æ–±—â–∏–º –Ω–µ –∏–∑–º–µ—Ä–∏—Ç—å', startTime: null, endTime: null },
          { text: '–£ –Ω–µ–π –æ—Å–æ–±–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç—å', startTime: null, endTime: null },
          { text: '–í –†–æ—Å—Å–∏—é –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤–µ—Ä–∏—Ç—å', startTime: null, endTime: null }
        ],
        selectedIndex: 0,
        radioGroup: 'lines',
        isPlaying: false,
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—â–µ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ
        totalDuration: 0,
        
        // Wavesurfer –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        wavesurfer: null,
        wsRegions: null,
        currentRegion: null,
        
        // –í—ã—á–∏—Å–ª—è–µ–º–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
        get effectiveRegion() {
          const line = this.lines[this.selectedIndex];
          if (!line) return { startTime: 0, text: '', endTime: 0 };
          if (this.currentRegion) {
            return {
              startTime: this.formatTime(this.currentRegion.start),
              text: line.text,
              endTime: this.formatTime(this.currentRegion.end)
            };
          } else {
            return {
              startTime: this.formatTime(line.startTime),
              text: line.text,
              endTime: this.formatTime(line.endTime)
            };
          }
        },

        get isFirstLine() {
          return this.selectedIndex === 0;
        },

        get isLastLine() {
          return this.selectedIndex === this.lines.length - 1;
        },

        // –ù–æ–≤–æ–µ –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç—Ä–æ–∫
        get remainingLinesCount() {
          return this.lines.length - this.selectedIndex - 1;
        },

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        init() {
          this.initWaveSurfer();
          this.setupWatchers();
        },
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WaveSurfer —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ
        initWaveSurfer() {
          this.wsRegions = WaveSurfer.Regions.create();
          this.wavesurfer = WaveSurfer.create({
            container: '#waveform',
            backend: 'WebAudio',
            plugins: [this.wsRegions]
          });
          this.wavesurfer.load('audio.mp3');

          this.wavesurfer.on('ready', () => {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—â—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            this.totalDuration = this.wavesurfer.getDuration();
            console.log('–û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ:', this.totalDuration);
            
            // –§–∏–∫—Å–∏—Ä—É–µ–º –∫–æ–Ω–µ—Ü –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –∫–æ–Ω–µ—Ü –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
            const lastIndex = this.lines.length - 1;
            this.lines[lastIndex].endTime = this.formatTime(this.totalDuration);
            
            this.selectLine(0);
          });
          
          this.wavesurfer.on('timeupdate', () => {
            if (this.currentRegion && this.isPlaying) {
              const currentTime = this.wavesurfer.getCurrentTime();
              const { end } = this.currentRegion;
              if (currentTime >= end) {
                this.wavesurfer.stop();
                this.isPlaying = false;
                this.wavesurfer.setTime(this.currentRegion.start);
              }
            }
          });
        },
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        setupWatchers() {
          this.lines.forEach((_, index) => {
            this.$watch(`lines[${index}].endTime`, () => {
              this.updateRegionFromModel(index);
              this.syncLineTimes(index, 'end');
            });
            
            this.$watch(`lines[${index}].startTime`, () => {
              this.updateRegionFromModel(index);
              this.syncLineTimes(index, 'start');
            });
          });
        },
        
        // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Å —É—á–µ—Ç–æ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç—Ä–æ–∫
        getLineConstraints(index) {
          const constraints = {};
          const isLastLine = index === this.lines.length - 1;
          
          // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
          if (index > 0) {
            const prevLine = this.lines[index - 1];
            constraints.minStart = prevLine.startTime !== null ? prevLine.startTime + this.MIN_DURATION : 0;
          } else {
            constraints.minStart = 0;
          }
          
          // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
          constraints.maxStart = this.lines[index].endTime !== null ?
            this.lines[index].endTime - this.MIN_DURATION :
            Infinity;
          
          // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è
          constraints.minEnd = this.lines[index].startTime !== null ?
            this.lines[index].startTime + this.MIN_DURATION :
            0;
          
          // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è —Å —É—á–µ—Ç–æ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç—Ä–æ–∫
          if (isLastLine) {
            // –î–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ –∫–æ–Ω–µ—Ü –≤—Å–µ–≥–¥–∞ –Ω–∞ –∫–æ–Ω—Ü–µ –∞—É–¥–∏–æ
            constraints.maxEnd = this.totalDuration;
            constraints.minEnd = Math.max(constraints.minEnd, this.totalDuration - this.MIN_DURATION);
          } else {
            const remainingLines = this.lines.length - index - 1;
            const reservedTime = remainingLines * this.MIN_DURATION;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç—Ä–æ–∫
            constraints.maxEnd = Math.min(
              this.totalDuration - reservedTime,
              this.lines[index + 1].endTime !== null ?
                this.lines[index + 1].endTime - this.MIN_DURATION :
                Infinity
            );
          }
          
          return constraints;
        },
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        syncLineTimes(index, type) {
          if (type === 'end' && index < this.lines.length - 1) {
            if (this.lines[index].endTime !== null) {
              this.lines[index + 1].startTime = this.lines[index].endTime;
            }
          } else if (type === 'start' && index > 0) {
            if (this.lines[index].startTime !== null) {
              this.lines[index - 1].endTime = this.lines[index].startTime;
            }
          }
        },
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        updateLineTime(index, newStart, newEnd) {
          this.lines[index].startTime = this.formatTime(newStart);
          this.lines[index].endTime = this.formatTime(newEnd);
          this.syncLineTimes(index, 'start');
          this.syncLineTimes(index, 'end');
        },
        
        // –í—ã–±–æ—Ä —Å—Ç—Ä–æ–∫–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞
        selectLine(index) {
          if (this.lines[index].startTime === null) return;
          this.selectedIndex = index;
          this.wsRegions.clearRegions();
          
          let { startTime, endTime } = this.lines[index];
          if (endTime === null) {
            // –î–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω–µ—Ü –∞—É–¥–∏–æ
            if (index === this.lines.length - 1) {
              endTime = this.totalDuration;
            }
            
            this.lines[index].endTime = endTime;
            
            if (index < this.lines.length - 1) {
              this.lines[index + 1].startTime = endTime;
            }
          }
          
          this.createRegion(index, startTime, endTime);
          this.wavesurfer.setTime(startTime);
        },
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
        createRegion(index, start, end) {
          // –î–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ –≤—Å–µ–≥–¥–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –∫–æ–Ω–µ—Ü –Ω–∞ –∫–æ–Ω—Ü–µ –∞—É–¥–∏–æ
          if (index === this.lines.length - 1) {
            end = this.totalDuration;
          }
          
          this.currentRegion = this.wsRegions.addRegion({
            start: start,
            end: end,
            color: 'rgba(79, 74, 133, 0.2)',
            drag: false,
            resizeStart: !this.isFirstLine,
            // –î–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ –∫–æ–Ω–µ—Ü –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è
            resizeEnd: !(this.isLastLine || index === this.lines.length - 1),
            color: 'rgba(0, 0, 0, 0.02)'
          });

          this.currentRegion.on('update', () => {
            let newStart = this.currentRegion.start;
            let newEnd = this.currentRegion.end;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–≥–∏–æ–Ω–∞
            if (newEnd - newStart < this.MIN_DURATION) {
              if (newStart !== this.lines[index].startTime) {
                newStart = newEnd - this.MIN_DURATION;
              } else {
                newEnd = newStart + this.MIN_DURATION;
              }
              this.currentRegion.setOptions({ start: newStart, end: newEnd });
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç—Ä–æ–∫
            const constraints = this.getLineConstraints(index);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
            if (newStart < constraints.minStart) {
              newStart = constraints.minStart;
              this.currentRegion.setOptions({ start: newStart });
            }
            
            if (newEnd > constraints.maxEnd) {
              newEnd = constraints.maxEnd;
              this.currentRegion.setOptions({ end: newEnd });
            }

            // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
            console.log(`–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index}:`, {
              minStart: constraints.minStart,
              maxStart: constraints.maxStart,
              minEnd: constraints.minEnd,
              maxEnd: constraints.maxEnd,
              currentEnd: newEnd
            });
          });

          this.currentRegion.on('update-end', () => {
            this.updateModelFromRegion(index);
          });
        },

        // –û—Å—Ç–∞–≤—à–∏–µ—Å—è –º–µ—Ç–æ–¥—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π


        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        formatTime(time) {
          return parseFloat(Number(time).toFixed(2));
        },
        
        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
        validateTime(index, type) {
          const line = this.lines[index];
          const value = type === 'start' ? line.startTime : line.endTime;
          
          // –ü—Ä–∏–≤–æ–¥–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫ —Ñ–æ—Ä–º–∞—Ç—É
          let correctedValue = this.formatTime(value);
          if (type === 'start' && correctedValue < 0) {
            correctedValue = 0;
          }
          
          // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
          const constraints = this.getLineConstraints(index);
          const minConstraint = type === 'start' ? constraints.minStart : constraints.minEnd;
          const maxConstraint = type === 'start' ? constraints.maxStart : constraints.maxEnd;
          
          if (correctedValue < minConstraint) {
            correctedValue = this.formatTime(minConstraint);
          }
          if (correctedValue > maxConstraint) {
            correctedValue = this.formatTime(maxConstraint);
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–æ–¥–µ–ª–∏
          if (type === 'start') {
            line.startTime = correctedValue;
          } else {
            line.endTime = correctedValue;
          }
          
          // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
          this.syncLineTimes(index, type);

          if (this.currentRegion && this.selectedIndex === index) {
            this.updateRegionFromModel(index);
          }
          
          return correctedValue;
        },
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–∏
        updateRegionFromModel(index) {
          if (this.currentRegion && this.selectedIndex === index) {
            const { startTime, endTime } = this.lines[index];
            this.currentRegion.setOptions({ start: startTime, end: endTime });
          }
        },

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏–π —Ä–µ–≥–∏–æ–Ω–∞
        updateModelFromRegion(index) {
          if (this.currentRegion && this.selectedIndex === index) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏–π —Ä–µ–≥–∏–æ–Ω–∞
            this.lines[index].startTime = this.formatTime(this.currentRegion.start);
            this.lines[index].endTime = this.formatTime(this.currentRegion.end);
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
            this.syncLineTimes(index, 'start');
            this.syncLineTimes(index, 'end');
          }
        },
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏
        selectPreviousLine() {
          let prevIndex = this.selectedIndex - 1;
          while (prevIndex >= 0 && this.lines[prevIndex].startTime === null) {
            prevIndex--;
          }
          if (prevIndex >= 0) {
            this.selectLine(prevIndex);
          }
        },

        selectNextLine() {
          let nextIndex = this.selectedIndex + 1;
          while (nextIndex < this.lines.length && this.lines[nextIndex].startTime === null) {
            nextIndex++;
          }
          if (nextIndex < this.lines.length) {
            this.selectLine(nextIndex);
          }
        },

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
        togglePlayPause() {
          if (this.isPlaying) {
            this.wavesurfer.pause();
            this.isPlaying = false;
          } else {
            if (this.currentRegion) {
              const currentTime = this.wavesurfer.getCurrentTime();
              const { start, end } = this.currentRegion;
              if (currentTime >= start && currentTime < end) {
                this.wavesurfer.play();
              } else {
                this.wavesurfer.setTime(start);
                this.wavesurfer.play();
              }
              this.isPlaying = true;
            }
          }
        },

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
        saveCurrentRegion() {
          console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', this.lines[this.selectedIndex]);
        }
      }));
    });
  </script>
</body>
</html>